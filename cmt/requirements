
package hltsv

manager Reiner.Hauser@cern.ch Denis.Fellmann@cern.ch Per.Werner@cern.ch

public

use TDAQPolicy

use ers
use eformat
use dynlibs
use EventStorage
use dal
use DFConfiguration
use tbb
use cmdl
use monsvc
use asyncmsg

use Boost * TDAQCExternal
use ROOT  * DQMCExternal

private

macro_append cppflags "-Wno-deprecated-declarations"

use genconfig

ignore_pattern inst_headers_
ignore_pattern inst_headers_auto
ignore_pattern inst_headers_bin_auto
ignore_pattern inst_idl_auto

macro           generate-config-include-dirs            "${TDAQ_INST_PATH}/share/data/dal ${TDAQ_INST_PATH}/share/data/DFConfiguration"
document        generate-config DFdal                   -s=../schema/                     \
                                                        namespace="daq::df"               \
                                                        include="hltsvdal"                \
                                                        hltsv.schema.xml                     

macro           gdir                                    "$(bin)DFdal.tmp"

library         daq-hltsv-dal                              "$(gdir)/*.cpp"

macro daq-hltsv-dal_dependencies "DFdal"

macro_append daq-hltsv-dal_shlibflags "-ldaq-core-dal -ldaq-df-dal"

library svl1source L1Source.cxx
macro svl1source_shlibflags "-ldcmessages"

application hltsv_main  hltsv_main.cxx Activity.cxx EventScheduler.cxx DCMSession.cxx ROSClear.cxx ROSSession.cxx Messages.cxx
macro hltsv_mainlinkopts "-lers -ltbb -leformat_write -leformat -ldcmessages -lac -lmsgconf -lsysmonapps -lsysmon -lhltinterface -lhistmon -lsvl1source -ldaq-hltsv-dal -lmonsvc -lmonsvcpub -lmonsvc-dal -lasyncmsg"
macro hltsv_main_dependencies "daq-hltsv-dal"

macro sw.repository.binary.hltsv_main:name         "HLT Supervisor"
macro sw.repository.binary.hltsv_main:description  "HLT Supervisor Application"

library svl1internal  L1InternalSource.cxx
macro svl1internal_shlibflags "-lers"
macro svl1internal_dependencies svl1source

library svl1preloaded L1PreloadedSource.cxx
macro svl1preloaded_shlibflags "-lers -leformat_write -leformat -lDataReader"
macro svl1preloaded_dependencies svl1source

library svl1filar L1FilarSource.cxx
macro svl1filar_shlibflags "-leformat_write -leformat -lfilar -lttcpr"
macro svl1filar_dependencies svl1source

macro constituents "svl1source hltsv_main svl1internal svl1preloaded svl1filar test_l1source testDCM" \
       x86_64 "svl1source hltsv_main svl1internal svl1preloaded test_l1source testDCM"

macro to_install "libsvl1source.so libsvl1internal.so libsvl1preloaded.so libsvl1filar.so libdaq-hltsv-dal.so" \
      x86_64 "libsvl1source.so libsvl1internal.so libsvl1preloaded.so libdaq-hltsv-dal.so"

application test_l1source ../test/test_l1source.cxx
macro test_l1sourcelinkopts "-lers -lsvl1source -lconfig -ldynlibs -ldaq-df-dal -ltbb -lcmdline"
macro test_l1source_dependencies svl1source

application testDCM ../test/testDCM.cxx
macro testDCMlinkopts "-lers -leformat -lac -ldcmessages -lmsginput -lmsgconf -lmsg -ldaq-df-dal"

macro sw.repository.binary.testDC:name         "Tester for hltsv"
macro sw.repository.binary.testDC:description  "Tester for hltsv"

apply_pattern install_libs files="${to_install}"
apply_pattern install_apps files="hltsv_main test_l1source testDCM"

apply_pattern   install_db_files name=schema            files="../schema/hltsv.schema.xml" \
                                                        target_dir="schema"

apply_pattern   install_data name=isschema              files="../schema/hltsv_is.schema.xml"\
							target_dir="schema"

